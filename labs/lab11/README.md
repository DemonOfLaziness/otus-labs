# Проектирование сети
 Топология сети для данной работы:  

![](netTopology.png)  

Cхемы сети и таблиц ip-адресации представлены [тут](https://github.com/DemonOfLaziness/otus-labs/tree/main/labs/lab10/Schemes).

Фрагмент общей схемы, на котором будут проводиться работы:  


Цели

- [Настройка отслеживания линка через технологию IP SLA]()
- [Распределение трафика между двумя линками с провайдером]()
- [Настройка для офиса Лабытнанги маршрута по умолчанию]()

## Настройка отслеживания линка через технологию IP SLA

Первоначально для выхода за пределы локальной сети нужно настроить маршрут по умолчанию и предусмотреть возможность резервирования маршрута на случай обрыва связи с провайдером. Так как в офисе два линка до ISP, остаётся только настроить роутер для отслеживания состояния канала и своевременного переключения на резервный, для чего предназначения технология IP SLA.  

Настройка пройдёт в 3 этапа - создание IP SLA (проверку), track (отслеживатель) для отслеживания состояния результатов проверки и создание маршрутов по умолчанию с прикрепленными к ним отслеживателями состояния линка к провайдеру (IP SLA просто проводит проверки, а на результаты проверок реагирует track, и только его состояния можно привязать к тем же маршрутам, например, напрямую связать состояния IP SLA с каким-либо действием (например, сменой маршрута по умолчанию или проверкой условия доступности next-hop в route-map) нельзя).  

Сначала нужно создать две проверки - по одной на каждый линк (№1 - для линка R28<->R25 и №2 для линка R28<->R26):  

```
R28(config)#
R28(config)#ip sla 1
R28(config-ip-sla)#icmp-echo 80.0.0.26 source-ip 80.0.0.25
R28(config-ip-sla-echo)#frequency 10
R28(config)#
R28(config)#
R28(config)#ip sla 2
R28(config-ip-sla)#icmp-echo 80.0.0.30 source-ip 80.0.0.29
R28(config-ip-sla-echo)#frequency 10

```   
IP-адрес, с которого отправляются ICMP-запросы, указан явным образом для того, чтобы проверка шла именно по линку между роутерами и ICMP-пакет не ушёл по другому каналу провайдера.  



Что, с каакого
частота проверки








## Распределить трафик между двумя линками с провайдером

![](userNet.png)  


## Настройка ip-адресов на каждом активном порту

Для каждого активного порта маршрутизатора был настроен адрес согласно разработанным ранее адресным пространствам. Результаты настроек представлены на схеме:  

![](ipScheme.png)  

## Настройка VPC в каждом офисе в своем VLAN

Для лабораторного стенда были выделены следующие VLAN:  

![](vlan.png)  

И в таблице представлены VLAN для VPC (ip-адреса для них распределяются DHCP-сервером). Наглядно распределение по VLAN видно на [схеме из пункта выше](#настройка-ip-адресов-на-каждом-активном-порту).

## Настройка VLAN/Loopback interface управления для сетевых устройств

Всем сетевые устройствам были настроены управляющие интерфейсы согласно согласно разработанным ранее адресным пространствам. Наглядно распределение интерфейсов видно на [схеме из пункта выше](#настройка-ip-адресов-на-каждом-активном-порту) (синим цветом под названием устройства).  

## Настройка сетей офисов так, чтобы не возникало broadcast штормов, и чтобы использование линков было максимально оптимизировано

Для оптимального использования линков на коммутаторах были (где возможно) настроены агрегация каналов, STP (с настройкой высокого приоритета агрегированных портов) и VTP v3. Все порты коммутаторов настроены в свои VLAN, а неиспользуемые - в специальный VLAN, а так же выключены. Кроме того, для отказоустойчивости планируется настройка GLBP (но это будет делаться параллельно с настройкой динамической маршрутизации для более корректной настройки).  
На данный момент решено не изменять количество линков между устройсвами, так как на текущем этапе не совсем ясно видно, что именно можно изменить для улучшения.